"use strict";(self.webpackChunkdhiwise_document=self.webpackChunkdhiwise_document||[]).push([[3848],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=p(t),m=r,f=c["".concat(s,".").concat(m)]||c[m]||d[m]||l;return t?a.createElement(f,o(o({ref:n},u),{},{components:t})):a.createElement(f,o({ref:n},u))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,o=new Array(l);o[0]=c;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var p=2;p<l;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},27645:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>p});var a=t(87462),r=(t(67294),t(3905));const l={sidebar_position:2},o="File Upload APIs",i={unversionedId:"node/generate-apis/file-upload-apis",id:"node/generate-apis/file-upload-apis",title:"File Upload APIs",description:"In DhiWise, you can configure APIs for upload attachment. You can have an API that can be used to upload file on a local machine, AWS S3 public bucket, and AWS S3 private bucket.",source:"@site/docs/node/generate-apis/file-upload-apis.md",sourceDirName:"node/generate-apis",slug:"/node/generate-apis/file-upload-apis",permalink:"/docs/node/generate-apis/file-upload-apis",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"node",previous:{title:"Log In using Social Authentication",permalink:"/docs/node/generate-apis/login-using-social-authentication"},next:{title:"CRUD APIs",permalink:"/docs/node/generate-apis/crud/"}},s={},p=[{value:"Sample request:",id:"sample-request",level:4},{value:"cURL",id:"curl",level:3},{value:"Nodejs Axios",id:"nodejs-axios",level:4},{value:"Sample request:",id:"sample-request-1",level:4},{value:"Get Presigned URL for S3 private Upload",id:"get-presigned-url-for-s3-private-upload",level:2},{value:"Sample request:",id:"sample-request-2",level:4},{value:"cURL",id:"curl-1",level:3},{value:"Nodejs Axios",id:"nodejs-axios-1",level:4},{value:"Sample success response:",id:"sample-success-response",level:4},{value:"Sample failure response",id:"sample-failure-response",level:4}],u={toc:p};function d(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"file-upload-apis"},"File Upload APIs"),(0,r.kt)("p",null,"In DhiWise, you can configure APIs for upload attachment. You can have an API that can be used to upload file on a local machine, AWS S3 public bucket, and AWS S3 private bucket."),(0,r.kt)("p",null,'Here is the API that one can use once the "upload attachment" configuration has been done.'),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"API for upload attachment will be the same in local upload, AWS S3 public, and private bucket.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"API URL:")," ",(0,r.kt)("e",{className:"post method"},"POST")," ",(0,r.kt)("inlineCode",{parentName:"p"},"<Base URL>/admin/upload")),(0,r.kt)("p",null,"To upload single or multiple files."),(0,r.kt)("h4",{id:"sample-request"},"Sample request:"),(0,r.kt)("p",null,"set header ",(0,r.kt)("inlineCode",{parentName:"p"},"{ 'Content-Type: multipart/form-data' }")," in a request."),(0,r.kt)("table",null,(0,r.kt)("tr",null,(0,r.kt)("th",null,"Key"),(0,r.kt)("th",null,"Description")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"file[]"),(0,r.kt)("td",null,"Select file/files to upload")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"folderName"),(0,r.kt)("td",null,"Optional, enable to upload file to specific folder")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"fileName"),(0,r.kt)("td",null,"Optional, enable to give Specific file name to uploaded File"))),(0,r.kt)("h3",{id:"curl"},"cURL"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"curl --location --request POST '<Base URL>/admin/upload' \\\n--header 'Content-Type: multipart/form-data' \\\n--form 'file[]=@\"/home/testuser/Pictures/img1.png\"' \\\n--form 'file[]=@\"/home/testuser/Pictures/img2.png\"' \\\n--form 'file[]=@\"/home/testuser/Pictures/img3.png\"' \n")),(0,r.kt)("h4",{id:"nodejs-axios"},"Nodejs Axios"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"var axios = require('axios');\nvar FormData = require('form-data');\nvar fs = require('fs');\nvar data = new FormData();\ndata.append('file[]', fs.createReadStream('/path/to/file'));\n\nvar config = {\n  method: 'post',\n  url: '<Base URL>/admin/upload',\n  headers: { \n    'Content-Type': 'multipart/form-data', \n    ...data.getHeaders()\n  },\n  data : data\n};\n\naxios(config)\n.then(function (response) {\n  console.log(JSON.stringify(response.data));\n})\n.catch(function (error) {\n  console.log(error);\n});\n")),(0,r.kt)("h4",{id:"sample-request-1"},"Sample request:"),(0,r.kt)("p",null,"Status code: ",(0,r.kt)("inlineCode",{parentName:"p"},"200")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "status": "SUCCESS",\n  "message": "4 File uploaded successfully out of 5",\n  "data": {\n    "uploadSuccess": [\n      {\n        "name": "img1.png",\n        "path": "{path where file has been uploaded}",\n        "status": true\n      },\n      {\n        "name": "img2.png",\n        "path": "{path where file has been uploaded}",\n        "status": true\n      }\n    ],\n    "uploadFailed": [\n      {\n        "name": "img3.png",\n        "error": "Filetype not allowed.",\n        "status": false\n      }\n    ]\n  }\n}\n')),(0,r.kt)("p",null,'If you have selected "S3 private upload" as a type of upload then project will have one extra API given below.'),(0,r.kt)("h2",{id:"get-presigned-url-for-s3-private-upload"},"Get Presigned URL for S3 private Upload"),(0,r.kt)("p",null,"Once file has been uploaded on S3 private bucket, we can not access that file without credentials.\nAWS gives facility that if one have presigned URL of uploaded file then using that URL you can open that file before specified time. By default DhiWise adds expiration time of 15 mins. You can also modified ",(0,r.kt)("inlineCode",{parentName:"p"},"AWS_URL_EXPIRATION")," variable declared in ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"API URL:")," ",(0,r.kt)("e",{className:"post method"},"POST")," ",(0,r.kt)("inlineCode",{parentName:"p"},"<Base URL>/admin/generate-pre-signed-url")),(0,r.kt)("h4",{id:"sample-request-2"},"Sample request:"),(0,r.kt)("p",null,"Status code: ",(0,r.kt)("inlineCode",{parentName:"p"},"200")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'{\n  {\n  "uri": "s3 URL"\n}\n')),(0,r.kt)("h3",{id:"curl-1"},"cURL"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"curl --location --request POST 'http://localhost:5000/admin/generate-pre-signed-url' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{\n  \"uri\": \"s3 URL\"\n}'\n")),(0,r.kt)("h4",{id:"nodejs-axios-1"},"Nodejs Axios"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"var axios = require('axios');\nvar data = JSON.stringify({\n  \"uri\": \"s3 URL\"\n});\n\nvar config = {\n  method: 'post',\n  url: '<Base URL>/admin/generate-pre-signed-url',\n  headers: { \n    'Content-Type': 'application/json'\n  },\n  data : data\n};\n\naxios(config)\n.then(function (response) {\n  console.log(JSON.stringify(response.data));\n})\n.catch(function (error) {\n  console.log(error);\n});\n")),(0,r.kt)("h4",{id:"sample-success-response"},"Sample success response:"),(0,r.kt)("p",null,"Status code: ",(0,r.kt)("inlineCode",{parentName:"p"},"200")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'{\n    "status": "SUCCESS",\n    "message": "Your request is successfully executed",\n    "data": [\n        {\n            "status": true,\n            "path": "URL to access file"\n        }\n    ]\n}\n')),(0,r.kt)("h4",{id:"sample-failure-response"},"Sample failure response"),(0,r.kt)("p",null,"Status code: ",(0,r.kt)("inlineCode",{parentName:"p"},"200")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'{\n    "status": "FAILURE",\n    "message": "{requested url} is not a valid S3 uri.",\n    "data": {},\n }\n')),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("p",null,"Got a question?\xa0",(0,r.kt)("a",{parentName:"p",href:"https://discord.com/invite/rFMnCG5MZ7"},(0,r.kt)("strong",{parentName:"a"},"Ask here")),"."))}d.isMDXComponent=!0}}]);